#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –¥–ª—è –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∏ –∏ –¥–µ–ø–ª–æ—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ —Å –∞–∫—Ç—É–∞–ª–∏–∑–∞—Ü–∏–µ–π –∫—ç—à–∞
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: ./redeploy-frontend.sh

set -e  # –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–∏ –æ—à–∏–±–∫–µ

echo "üî® –ü–µ—Ä–µ—Å–±–æ—Ä–∫–∞ –∏ –¥–µ–ø–ª–æ–π —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ —Å –æ—á–∏—Å—Ç–∫–æ–π –∫—ç—à–∞..."
echo ""

# –¶–≤–µ—Ç–∞ –¥–ª—è –≤—ã–≤–æ–¥–∞
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
RED='\033[0;31m'
NC='\033[0m' # No Color

# 1. –ü–µ—Ä–µ—Ö–æ–¥ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é frontend
echo -e "${YELLOW}üìÅ –ü–µ—Ä–µ—Ö–æ–¥ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é frontend...${NC}"
cd frontend

# 2. –ü–µ—Ä–µ—Å–±–æ—Ä–∫–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞
echo -e "${YELLOW}üî® –ü–µ—Ä–µ—Å–±–æ—Ä–∫–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ —Å –Ω–æ–≤—ã–º–∏ —Ö–µ—à–∞–º–∏...${NC}"
npm run build

if [ $? -ne 0 ]; then
    echo -e "${RED}‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–±–æ—Ä–∫–µ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞!${NC}"
    exit 1
fi

echo -e "${GREEN}‚úÖ –§—Ä–æ–Ω—Ç–µ–Ω–¥ —Å–æ–±—Ä–∞–Ω —É—Å–ø–µ—à–Ω–æ!${NC}"
echo ""

# 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
echo -e "${YELLOW}üê≥ –ü—Ä–æ–≤–µ—Ä–∫–∞ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ frontend...${NC}"
cd ..

if ! docker ps | grep -q "ai-image-bot-frontend"; then
    echo -e "${RED}‚ùå –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä ai-image-bot-frontend –Ω–µ –∑–∞–ø—É—â–µ–Ω!${NC}"
    echo -e "${YELLOW}–ó–∞–ø—É—Å–∫–∞—é –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä...${NC}"
    docker-compose up -d frontend
fi

# 4. –ü–µ—Ä–µ—Å–±–æ—Ä–∫–∞ Docker –æ–±—Ä–∞–∑–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞
echo -e "${YELLOW}üê≥ –ü–µ—Ä–µ—Å–±–æ—Ä–∫–∞ Docker –æ–±—Ä–∞–∑–∞ frontend...${NC}"
docker-compose build --no-cache frontend

if [ $? -ne 0 ]; then
    echo -e "${RED}‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–±–æ—Ä–∫–µ Docker –æ–±—Ä–∞–∑–∞!${NC}"
    exit 1
fi

echo -e "${GREEN}‚úÖ Docker –æ–±—Ä–∞–∑ —Å–æ–±—Ä–∞–Ω —É—Å–ø–µ—à–Ω–æ!${NC}"
echo ""

# 5. –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
echo -e "${YELLOW}üîÑ –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ frontend...${NC}"
docker-compose down frontend
docker-compose up -d frontend

if [ $? -ne 0 ]; then
    echo -e "${RED}‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞!${NC}"
    exit 1
fi

echo -e "${GREEN}‚úÖ –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω!${NC}"
echo ""

# 6. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
echo -e "${YELLOW}üìä –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞...${NC}"
docker ps | grep frontend

echo ""
echo -e "${GREEN}üéâ –î–µ–ø–ª–æ–π –∑–∞–≤–µ—Ä—à—ë–Ω —É—Å–ø–µ—à–Ω–æ!${NC}"
echo ""
echo -e "${YELLOW}üìù –í–∞–∂–Ω–æ:${NC}"
echo "1. index.html —Ç–µ–ø–µ—Ä—å –ù–ï –∫—ç—à–∏—Ä—É–µ—Ç—Å—è"
echo "2. JS/CSS —Ñ–∞–π–ª—ã –∏–º–µ—é—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ —Ö–µ—à–∏ –≤ –∏–º–µ–Ω–∞—Ö"
echo "3. –ë—Ä–∞—É–∑–µ—Ä –¥–æ–ª–∂–µ–Ω –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å–≤–µ–∂—É—é –≤–µ—Ä—Å–∏—é –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏"
echo ""
echo -e "${YELLOW}üîç –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏–º–µ–Ω–∏–ª–æ—Å—å:${NC}"
echo "1. –ó–∞–∫—Ä–æ–π—Ç–µ –≤–∫–ª–∞–¥–∫—É/–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ hard reload (Cmd+Shift+R / Ctrl+Shift+R)"
echo "2. –û—á–∏—Å—Ç–∏—Ç–µ –∫—ç—à —Å–∞–π—Ç–∞ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –±—Ä–∞—É–∑–µ—Ä–∞ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏"
echo "3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Ñ–∞–π–ª—ã –∏–º–µ—é—Ç –Ω–æ–≤—ã–µ —Ö–µ—à–∏"
echo ""
echo -e "${YELLOW}‚ö†Ô∏è  –ï—Å–ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤—Å—ë –µ—â—ë –Ω–µ –≤–∏–¥–Ω—ã:${NC}"
echo "1. –û—á–∏—Å—Ç–∏—Ç–µ –∫—ç—à –±—Ä–∞—É–∑–µ—Ä–∞ –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –Ω–æ–≤—ã–π URL –≤–∏–¥–∞ https://example.com?v=2"
echo "2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ CDN/–ø—Ä–æ–∫—Å–∏ –æ—Ç–¥–∞—é—Ç –Ω–æ–≤—ã–µ —Ñ–∞–π–ª—ã"
echo ""

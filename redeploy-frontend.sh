#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –¥–ª—è –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∏ –∏ –¥–µ–ø–ª–æ—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ —Å –æ—á–∏—Å—Ç–∫–æ–π –∫—ç—à–∞ Telegram WebApp
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: ./redeploy-frontend.sh

set -e  # –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–∏ –æ—à–∏–±–∫–µ

echo "üî® –ü–µ—Ä–µ—Å–±–æ—Ä–∫–∞ –∏ –¥–µ–ø–ª–æ–π —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ —Å –æ—á–∏—Å—Ç–∫–æ–π –∫—ç—à–∞..."
echo ""

# –¶–≤–µ—Ç–∞ –¥–ª—è –≤—ã–≤–æ–¥–∞
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
RED='\033[0;31m'
NC='\033[0m' # No Color

# 1. –ü–µ—Ä–µ—Ö–æ–¥ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é frontend
echo -e "${YELLOW}üìÅ –ü–µ—Ä–µ—Ö–æ–¥ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é frontend...${NC}"
cd frontend

# 2. –ü–µ—Ä–µ—Å–±–æ—Ä–∫–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞
echo -e "${YELLOW}üî® –ü–µ—Ä–µ—Å–±–æ—Ä–∫–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ —Å –Ω–æ–≤—ã–º–∏ —Ö–µ—à–∞–º–∏...${NC}"
npm run build

if [ $? -ne 0 ]; then
    echo -e "${RED}‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–±–æ—Ä–∫–µ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞!${NC}"
    exit 1
fi

echo -e "${GREEN}‚úÖ –§—Ä–æ–Ω—Ç–µ–Ω–¥ —Å–æ–±—Ä–∞–Ω —É—Å–ø–µ—à–Ω–æ!${NC}"
echo ""

# 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
echo -e "${YELLOW}üê≥ –ü—Ä–æ–≤–µ—Ä–∫–∞ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ frontend...${NC}"
cd ..

if ! docker ps | grep -q "ai-image-bot-frontend"; then
    echo -e "${RED}‚ùå –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä ai-image-bot-frontend –Ω–µ –∑–∞–ø—É—â–µ–Ω!${NC}"
    echo -e "${YELLOW}–ó–∞–ø—É—Å–∫–∞—é –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä...${NC}"
    docker-compose up -d frontend
fi

# 4. –ü–µ—Ä–µ—Å–±–æ—Ä–∫–∞ Docker –æ–±—Ä–∞–∑–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞
echo -e "${YELLOW}üê≥ –ü–µ—Ä–µ—Å–±–æ—Ä–∫–∞ Docker –æ–±—Ä–∞–∑–∞ frontend...${NC}"
docker-compose build --no-cache frontend

if [ $? -ne 0 ]; then
    echo -e "${RED}‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–±–æ—Ä–∫–µ Docker –æ–±—Ä–∞–∑–∞!${NC}"
    exit 1
fi

echo -e "${GREEN}‚úÖ Docker –æ–±—Ä–∞–∑ —Å–æ–±—Ä–∞–Ω —É—Å–ø–µ—à–Ω–æ!${NC}"
echo ""

# 5. –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
echo -e "${YELLOW}üîÑ –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ frontend...${NC}"
docker-compose down frontend
docker-compose up -d frontend

if [ $? -ne 0 ]; then
    echo -e "${RED}‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞!${NC}"
    exit 1
fi

echo -e "${GREEN}‚úÖ –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω!${NC}"
echo ""

# 6. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
echo -e "${YELLOW}üìä –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞...${NC}"
docker ps | grep frontend

echo ""
echo -e "${GREEN}üéâ –î–µ–ø–ª–æ–π –∑–∞–≤–µ—Ä—à—ë–Ω —É—Å–ø–µ—à–Ω–æ!${NC}"
echo ""
echo -e "${YELLOW}üìù –í–∞–∂–Ω–æ:${NC}"
echo "1. index.html —Ç–µ–ø–µ—Ä—å –ù–ï –∫—ç—à–∏—Ä—É–µ—Ç—Å—è"
echo "2. JS/CSS —Ñ–∞–π–ª—ã –∏–º–µ—é—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ —Ö–µ—à–∏ –≤ –∏–º–µ–Ω–∞—Ö"
echo "3. Telegram WebApp –¥–æ–ª–∂–µ–Ω –∑–∞–≥—Ä—É–∑–∏—Ç—å –Ω–æ–≤—É—é –≤–µ—Ä—Å–∏—é –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏"
echo ""
echo -e "${YELLOW}üîç –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏–º–µ–Ω–∏–ª–æ—Å—å:${NC}"
echo "1. –ü–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–∫—Ä–æ–π—Ç–µ Telegram (—Å–≤–∞–π–ø –≤–≤–µ—Ä—Ö –Ω–∞ iOS/Android)"
echo "2. –ó–∞–Ω–æ–≤–æ –æ—Ç–∫—Ä–æ–π—Ç–µ –±–æ—Ç–∞ –∏ WebApp"
echo "3. –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫—É '–û–±–Ω–æ–≤–∏—Ç—å' –≤ –º–µ–Ω—é –±–æ—Ç–∞ (–µ—Å–ª–∏ –µ—Å—Ç—å)"
echo ""
echo -e "${YELLOW}‚ö†Ô∏è  –ï—Å–ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤—Å—ë –µ—â—ë –Ω–µ –≤–∏–¥–Ω—ã:${NC}"
echo "1. –ü–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Telegram –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ"
echo "2. –ò–ª–∏ –∏–∑–º–µ–Ω–∏—Ç–µ URL WebApp –≤ BotFather (–¥–æ–±–∞–≤—å—Ç–µ ?v=2 –≤ –∫–æ–Ω—Ü–µ)"
echo ""

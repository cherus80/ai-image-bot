# üöÄ –û—Ç—á—ë—Ç –æ –¥–µ–ø–ª–æ–µ v0.11.3 - Cache Busting Fix

**–î–∞—Ç–∞:** 2025-11-16
**–í–µ—Ä—Å–∏—è:** 0.11.3
**VPS:** ai-bot-media.mix4.ru (185.135.82.109)
**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–£–°–ü–ï–®–ù–û –ó–ê–î–ï–ü–õ–û–ï–ù–û**

---

## üìã –ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ

–†–µ—à–µ–Ω–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–±–ª–µ–º–∞ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è Telegram WebApp. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –±–æ–ª—å—à–µ –Ω–µ –±—É–¥—É—Ç –≤–∏–¥–µ—Ç—å —Å—Ç–∞—Ä—ã–µ –≤–µ—Ä—Å–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è.

---

## üîß –ß—Ç–æ –±—ã–ª–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

### 1. Cache Busting –≤ Vite (frontend/vite.config.ts)

–î–æ–±–∞–≤–ª–µ–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ –ø—Ä–∏ —Å–±–æ—Ä–∫–µ:

```typescript
build: {
  rollupOptions: {
    output: {
      entryFileNames: 'assets/[name].[hash].js',
      chunkFileNames: 'assets/[name].[hash].js',
      assetFileNames: 'assets/[name].[hash].[ext]'
    }
  }
}
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- `index.js` ‚Üí `index.D-3K7sLD.js` (—É–Ω–∏–∫–∞–ª—å–Ω—ã–π —Ö–µ—à –ø—Ä–∏ –∫–∞–∂–¥–æ–π —Å–±–æ—Ä–∫–µ)
- `main.css` ‚Üí `index.C1nxOu1a.css`

### 2. –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ Nginx (frontend/nginx.conf)

**index.html:** –ù–ï –∫—ç—à–∏—Ä—É–µ—Ç—Å—è (–≤—Å–µ–≥–¥–∞ —Å–≤–µ–∂–∏–π)
```nginx
location / {
    add_header Cache-Control "no-cache, no-store, must-revalidate";
    add_header Pragma "no-cache";
    add_header Expires "0";
}
```

**JS/CSS —Ñ–∞–π–ª—ã:** –ö—ç—à–∏—Ä—É—é—Ç—Å—è –Ω–∞ 1 –≥–æ–¥ (–±–µ–∑–æ–ø–∞—Å–Ω–æ, —Ç.–∫. –∏–º–µ–Ω–∞ —É–Ω–∏–∫–∞–ª—å–Ω—ã)
```nginx
location ~* \.(js|css)$ {
    expires 1y;
    add_header Cache-Control "public, max-age=31536000, immutable";
}
```

**–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è/—à—Ä–∏—Ñ—Ç—ã:** –ö—ç—à–∏—Ä—É—é—Ç—Å—è –Ω–∞ 7 –¥–Ω–µ–π
```nginx
location ~* \.(jpg|jpeg|png|gif|ico|svg|woff|woff2|ttf|eot)$ {
    expires 7d;
    add_header Cache-Control "public, max-age=604800";
}
```

### 3. –°–∫—Ä–∏–ø—Ç—ã –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏

–°–æ–∑–¥–∞–Ω—ã —Å–∫—Ä–∏–ø—Ç—ã –¥–ª—è —É–¥–æ–±–Ω–æ–≥–æ –¥–µ–ø–ª–æ—è:
- `redeploy-frontend.sh` - –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –¥–µ–ø–ª–æ—è (—Ç—Ä–µ–±—É–µ—Ç Node.js –Ω–∞ VPS)
- `deploy-frontend-to-vps.sh` - –¥–ª—è –¥–µ–ø–ª–æ—è —Å –ª–æ–∫–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω—ã (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)

---

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–µ–ø–ª–æ—è

### 1. –°—Ç–∞—Ç—É—Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤

–í—Å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ:

```
ai_image_bot_frontend_prod    Up (healthy)   127.0.0.1:3000->80/tcp
ai_image_bot_backend_prod     Up (healthy)   127.0.0.1:8000->8000/tcp
ai_image_bot_postgres_prod    Up (healthy)   127.0.0.1:5432->5432/tcp
ai_image_bot_redis_prod       Up (healthy)   127.0.0.1:6379->6379/tcp
ai_image_bot_telegram_prod    Up (healthy)
ai_image_bot_celery_worker_prod   Up (healthy)
ai_image_bot_celery_beat_prod     Up
```

### 2. Cache-Control Headers

**‚úÖ index.html:**
```
cache-control: no-cache, no-store, must-revalidate
```

**‚úÖ JS —Ñ–∞–π–ª—ã (—Å —Ö–µ—à–æ–º):**
```
cache-control: public, max-age=31536000, immutable
expires: Mon, 16 Nov 2026 04:41:59 GMT
```

### 3. –§–∞–π–ª—ã —Å —Ö–µ—à–∞–º–∏

**index.html —Å–æ–¥–µ—Ä–∂–∏—Ç:**
```html
<script type="module" crossorigin src="/assets/index.D-3K7sLD.js"></script>
<link rel="stylesheet" crossorigin href="/assets/index.C1nxOu1a.css">
```

‚úÖ –•–µ—à–∏ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç –≤ –∏–º–µ–Ω–∞—Ö —Ñ–∞–π–ª–æ–≤!

---

## üìù –ö–æ–º–º–∏—Ç—ã

1. **58cabb3** - `fix: cache busting –¥–ª—è Telegram WebApp (v0.11.3)`
   - –î–æ–±–∞–≤–ª–µ–Ω cache busting –≤ Vite
   - –û–±–Ω–æ–≤–ª–µ–Ω–∞ nginx –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
   - –°–æ–∑–¥–∞–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

2. **b505831** - `fix: nginx regex syntax –¥–ª—è cache busting`
   - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω regex (—É–±—Ä–∞–Ω `{8,}` –∫–æ—Ç–æ—Ä—ã–π nginx –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç)

3. **89f1ea3** - `fix: —É–ø—Ä–æ—â—ë–Ω nginx regex –¥–ª—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è`
   - –£–ø—Ä–æ—â–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è (–≤—Å–µ JS/CSS ‚Üí 1 –≥–æ–¥)

---

## üåê –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

**URL:** https://ai-bot-media.mix4.ru

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```bash
curl -I https://ai-bot-media.mix4.ru/
# HTTP/2 200
# cache-control: no-cache, no-store, must-revalidate
```

---

## üìö –°–æ–∑–¥–∞–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

1. **[QUICK_DEPLOY.md](QUICK_DEPLOY.md)** - –ë—ã—Å—Ç—Ä–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –¥–µ–ø–ª–æ—é (5 –º–∏–Ω—É—Ç)
2. **[docs/CACHE_BUSTING.md](docs/CACHE_BUSTING.md)** - –ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Å troubleshooting
3. **[CHANGELOG.md](CHANGELOG.md)** - v0.11.3 –∑–∞–ø–∏—Å–∞–Ω

---

## üîÑ –ß—Ç–æ –¥–µ–ª–∞—Ç—å –¥–∞–ª—å—à–µ (–¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π)

### –ù–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–µ (iOS/Android):

**–í–∞—Ä–∏–∞–Ω—Ç 1: –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ Telegram**
1. –ü–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–∫—Ä–æ–π—Ç–µ Telegram (—Å–≤–∞–π–ø –≤–≤–µ—Ä—Ö/force close)
2. –ü–æ–¥–æ–∂–¥–∏—Ç–µ 5 —Å–µ–∫—É–Ω–¥
3. –û—Ç–∫—Ä–æ–π—Ç–µ —Å–Ω–æ–≤–∞
4. –û—Ç–∫—Ä–æ–π—Ç–µ –±–æ—Ç–∞ –∏ WebApp

**–í–∞—Ä–∏–∞–Ω—Ç 2: –û—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞**
- iOS: Settings ‚Üí Data and Storage ‚Üí Storage Usage ‚Üí Clear Cache
- Android: Settings ‚Üí Data and Storage ‚Üí Storage Usage ‚Üí Clear Cache

### –ù–∞ –∫–æ–º–ø—å—é—Ç–µ—Ä–µ (Desktop):

**–í–∞—Ä–∏–∞–Ω—Ç 1: –û—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞**
```bash
# macOS:
rm -rf ~/Library/Application\ Support/Telegram\ Desktop/tdata/user_data/webview_cache

# Windows:
del /s /q %APPDATA%\Telegram Desktop\tdata\user_data\webview_cache

# Linux:
rm -rf ~/.local/share/TelegramDesktop/tdata/user_data/webview_cache
```

**–í–∞—Ä–∏–∞–Ω—Ç 2: DevTools**
1. –û—Ç–∫—Ä–æ–π—Ç–µ WebApp
2. –ü—Ä–∞–≤—ã–π –∫–ª–∏–∫ ‚Üí Inspect Element
3. Application ‚Üí Clear Storage ‚Üí Clear site data
4. –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É (Cmd+R / Ctrl+R)

### ‚ö†Ô∏è –ï—Å–ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤—Å—ë –µ—â—ë –Ω–µ –≤–∏–¥–Ω—ã:

**–ò–∑–º–µ–Ω–∏—Ç—å URL WebApp –≤ @BotFather:**
1. –û—Ç–∫—Ä–æ–π—Ç–µ @BotFather
2. `/mybots` ‚Üí –≤–∞—à –±–æ—Ç ‚Üí Edit Bot ‚Üí Edit Bot WebApp URL
3. –î–æ–±–∞–≤—å—Ç–µ `?v=2`:
   ```
   –ë—ã–ª–æ: https://ai-bot-media.mix4.ru
   –°—Ç–∞–ª–æ: https://ai-bot-media.mix4.ru?v=2
   ```

–ü—Ä–∏ —Å–ª–µ–¥—É—é—â–∏—Ö –¥–µ–ø–ª–æ—è—Ö: `?v=3`, `?v=4` –∏ —Ç.–¥.

---

## üéØ –ö–∞–∫ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –≤ –±—É–¥—É—â–µ–º

### –ü—Ä–∏ —Å–ª–µ–¥—É—é—â–∏—Ö –¥–µ–ø–ª–æ—è—Ö:

1. **–í–Ω–µ—Å–∏—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥**
2. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç:**
   ```bash
   ./deploy-frontend-to-vps.sh
   ```
3. **Telegram –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–≥—Ä—É–∑–∏—Ç –Ω–æ–≤—É—é –≤–µ—Ä—Å–∏—é**, –ø–æ—Ç–æ–º—É —á—Ç–æ:
   - `index.html` –Ω–µ –∫—ç—à–∏—Ä—É–µ—Ç—Å—è (–≤—Å–µ–≥–¥–∞ —Å–≤–µ–∂–∏–π)
   - `index.html` —Å–æ–¥–µ—Ä–∂–∏—Ç –Ω–æ–≤—ã–µ —Ö–µ—à–∏ —Ñ–∞–π–ª–æ–≤
   - –ë—Ä–∞—É–∑–µ—Ä –≤–∏–¥–∏—Ç –Ω–æ–≤—ã–µ –∏–º–µ–Ω–∞ —Ñ–∞–π–ª–æ–≤ ‚Üí —Å–∫–∞—á–∏–≤–∞–µ—Ç –∏—Ö

**–ë–æ–ª—å—à–µ –ù–ï –Ω—É–∂–Ω–æ:**
- –í—Ä—É—á–Ω—É—é —á–∏—Å—Ç–∏—Ç—å –∫—ç—à Telegram
- –ò–∑–º–µ–Ω—è—Ç—å URL WebApp –≤ BotFather
- –ü–µ—Ä–µ—Å–æ–±–∏—Ä–∞—Ç—å Docker –æ–±—Ä–∞–∑—ã –≤—Ä—É—á–Ω—É—é

---

## üìä –ú–µ—Ç—Ä–∏–∫–∏ –¥–µ–ø–ª–æ—è

- **–í—Ä–µ–º—è —Å–±–æ—Ä–∫–∏ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞:** ~17 —Å–µ–∫—É–Ω–¥
- **–í—Ä–µ–º—è —Å–±–æ—Ä–∫–∏ Docker –æ–±—Ä–∞–∑–∞:** ~45 —Å–µ–∫—É–Ω–¥
- **–û–±—â–µ–µ –≤—Ä–µ–º—è –¥–µ–ø–ª–æ—è:** ~2-3 –º–∏–Ω—É—Ç—ã
- **–†–∞–∑–º–µ—Ä –±–∞–Ω–¥–ª–∞:**
  - JS: 528.92 kB (161.96 kB gzip)
  - CSS: 51.40 kB (8.87 kB gzip)
  - index.html: 0.58 kB (0.36 kB gzip)

---

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

1. **–•–µ—à–∏ –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è –ø—Ä–∏ –∫–∞–∂–¥–æ–π —Å–±–æ—Ä–∫–µ** - –¥–∞–∂–µ –µ—Å–ª–∏ –∫–æ–¥ –Ω–µ –∏–∑–º–µ–Ω–∏–ª—Å—è, —Ö–µ—à –±—É–¥–µ—Ç –Ω–æ–≤—ã–π
2. **index.html –≤—Å–µ–≥–¥–∞ —Å–≤–µ–∂–∏–π** - Telegram –Ω–µ –º–æ–∂–µ—Ç –µ–≥–æ –∑–∞–∫—ç—à–∏—Ä–æ–≤–∞—Ç—å
3. **JS/CSS –∫—ç—à–∏—Ä—É—é—Ç—Å—è –Ω–∞ 1 –≥–æ–¥** - –±–µ–∑–æ–ø–∞—Å–Ω–æ, —Ç.–∫. –∏–º–µ–Ω–∞ —É–Ω–∏–∫–∞–ª—å–Ω—ã
4. **–ü—Ä–∏ –∫–∞–∂–¥–æ–º –¥–µ–ø–ª–æ–µ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –≤—Å–µ —Ñ–∞–π–ª—ã** - –¥–∞–∂–µ –µ—Å–ª–∏ –∏–∑–º–µ–Ω–∏–ª—Å—è —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω –∫–æ–º–ø–æ–Ω–µ–Ω—Ç

---

## üîó –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –Ω–∞ VPS:
```bash
ssh ai-bot-vps "cd /root/ai-image-bot && docker-compose -f docker-compose.prod.yml ps"
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤ frontend:
```bash
ssh ai-bot-vps "cd /root/ai-image-bot && docker-compose -f docker-compose.prod.yml logs -f frontend"
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ headers:
```bash
curl -I https://ai-bot-media.mix4.ru/
curl -I https://ai-bot-media.mix4.ru/assets/index.D-3K7sLD.js
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ index.html:
```bash
curl -s https://ai-bot-media.mix4.ru/ | grep -o 'src="[^"]*\.js"'
```

---

## ‚úÖ –ò—Ç–æ–≥–∏

üéâ **–î–µ–ø–ª–æ–π v0.11.3 —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à—ë–Ω!**

**–ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ:**
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–±–ª–µ–º–∞ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è Telegram WebApp
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω cache busting (—Ö–µ—à–∏ –≤ –∏–º–µ–Ω–∞—Ö —Ñ–∞–π–ª–æ–≤)
- ‚úÖ –ù–∞—Å—Ç—Ä–æ–µ–Ω–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ Nginx
- ‚úÖ –°–æ–∑–¥–∞–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∏ —Å–∫—Ä–∏–ø—Ç—ã –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏
- ‚úÖ –ó–∞–¥–µ–ø–ª–æ–µ–Ω–æ –Ω–∞ production VPS
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–µ–Ω—ã –≤—Å–µ headers –∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

**–°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:**
1. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö Telegram –∫–ª–∏–µ–Ω—Ç–∞—Ö (iOS/Android/Desktop)
2. –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –¥–æ–±–∞–≤–∏—Ç—å `?v=2` –≤ URL WebApp –≤ BotFather
3. –ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å –ª–æ–≥–∏ –Ω–∞ –ø—Ä–µ–¥–º–µ—Ç –æ—à–∏–±–æ–∫

---

**–ü–æ–¥–≥–æ—Ç–æ–≤–∏–ª:** Claude Code
**–î–∞—Ç–∞:** 2025-11-16 04:42 UTC

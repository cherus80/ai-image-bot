# üöÄ –ë—ã—Å—Ç—Ä—ã–π –¥–µ–ø–ª–æ–π –∏–∑–º–µ–Ω–µ–Ω–∏–π —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞

## –ü—Ä–æ–±–ª–µ–º–∞ —Ä–µ—à–µ–Ω–∞! ‚úÖ

Telegram WebApp –±–æ–ª—å—à–µ –Ω–µ –±—É–¥–µ—Ç –∫—ç—à–∏—Ä–æ–≤–∞—Ç—å —Å—Ç–∞—Ä—ã–µ –≤–µ—Ä—Å–∏–∏.

## –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ:

1. ‚úÖ **Cache busting**: –§–∞–π–ª—ã —Ç–µ–ø–µ—Ä—å –∏–º–µ—é—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ —Ö–µ—à–∏ (`index.a1b2c3d4.js`)
2. ‚úÖ **Nginx config**: `index.html` –Ω–µ –∫—ç—à–∏—Ä—É–µ—Ç—Å—è, –≤—Å–µ–≥–¥–∞ —Å–≤–µ–∂–∏–π
3. ‚úÖ **Deploy script**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –¥–µ–ø–ª–æ—è

## üìã –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–ª—è –¥–µ–ø–ª–æ—è

### –®–∞–≥ 1: –ó–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –Ω–∞ VPS

```bash
# –ù–∞ –ª–æ–∫–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω–µ:
git add .
git commit -m "fix: cache busting –¥–ª—è Telegram WebApp (v0.11.3)"
git push origin master

# –ù–∞ VPS (SSH):
cd /path/to/ai-image-bot
git pull origin master
```

### –®–∞–≥ 2: –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–∫—Ä–∏–ø—Ç –¥–µ–ø–ª–æ—è

```bash
# –ù–∞ VPS:
./redeploy-frontend.sh
```

**–°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:**
- –ü–µ—Ä–µ—Å–æ–±–µ—Ä—ë—Ç —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ —Å –Ω–æ–≤—ã–º–∏ —Ö–µ—à–∞–º–∏
- –ü–µ—Ä–µ—Å–æ–±–µ—Ä—ë—Ç Docker –æ–±—Ä–∞–∑ –ë–ï–ó –∫—ç—à–∞
- –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä frontend
- –ü—Ä–æ–≤–µ—Ä–∏—Ç —Å—Ç–∞—Ç—É—Å

### –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä:
docker ps | grep frontend

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏:
docker logs ai-image-bot-frontend --tail 50

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å headers:
curl -I https://your-domain.com/
# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å: Cache-Control: no-cache, no-store, must-revalidate

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ —Ñ–∞–π–ª—ã —Å —Ö–µ—à–∞–º–∏:
curl https://your-domain.com/ | grep -o 'src="[^"]*\.js"'
# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å: src="/assets/index.a1b2c3d4.js"
```

### –®–∞–≥ 4: –û—á–∏—Å—Ç–∏—Ç—å –∫—ç—à Telegram

#### –ù–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–µ (iOS/Android):

**–í–∞—Ä–∏–∞–Ω—Ç 1: –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ**
- –ü–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–∫—Ä–æ–π—Ç–µ Telegram (—Å–≤–∞–π–ø –≤–≤–µ—Ä—Ö)
- –ü–æ–¥–æ–∂–¥–∏—Ç–µ 5 —Å–µ–∫—É–Ω–¥
- –û—Ç–∫—Ä–æ–π—Ç–µ —Å–Ω–æ–≤–∞ ‚Üí –æ—Ç–∫—Ä–æ–π—Ç–µ –±–æ—Ç–∞ ‚Üí –æ—Ç–∫—Ä–æ–π—Ç–µ WebApp

**–í–∞—Ä–∏–∞–Ω—Ç 2: –û—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞**
- iOS: Settings ‚Üí Data and Storage ‚Üí Storage Usage ‚Üí Clear Cache
- Android: Settings ‚Üí Data and Storage ‚Üí Storage Usage ‚Üí Clear Cache

#### –ù–∞ –∫–æ–º–ø—å—é—Ç–µ—Ä–µ (Desktop):

**–í–∞—Ä–∏–∞–Ω—Ç 1: –û—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞ (–ª—É—á—à–∏–π)**
```bash
# macOS:
rm -rf ~/Library/Application\ Support/Telegram\ Desktop/tdata/user_data/webview_cache

# Windows:
del /s /q %APPDATA%\Telegram Desktop\tdata\user_data\webview_cache

# Linux:
rm -rf ~/.local/share/TelegramDesktop/tdata/user_data/webview_cache
```

**–í–∞—Ä–∏–∞–Ω—Ç 2: DevTools**
- –û—Ç–∫—Ä–æ–π—Ç–µ WebApp
- –ü—Ä–∞–≤—ã–π –∫–ª–∏–∫ ‚Üí Inspect Element
- Application ‚Üí Clear Storage ‚Üí Clear site data
- –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É (Cmd+R / Ctrl+R)

## ‚ö†Ô∏è –ï—Å–ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤—Å—ë –µ—â—ë –Ω–µ –≤–∏–¥–Ω—ã

### –ú–µ—Ç–æ–¥ 1: –ò–∑–º–µ–Ω–∏—Ç—å URL WebApp (–≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç)

1. –û—Ç–∫—Ä–æ–π—Ç–µ @BotFather
2. /mybots ‚Üí –≤–∞—à –±–æ—Ç ‚Üí Edit Bot ‚Üí Edit Bot WebApp URL
3. –î–æ–±–∞–≤—å—Ç–µ `?v=2` –∫ URL:

```
–ë—ã–ª–æ: https://your-domain.com
–°—Ç–∞–ª–æ: https://your-domain.com?v=2
```

4. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ
5. –û—Ç–∫—Ä–æ–π—Ç–µ WebApp —Å–Ω–æ–≤–∞

**–ü—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º –¥–µ–ø–ª–æ–µ:** –∏–∑–º–µ–Ω–∏—Ç–µ –Ω–∞ `?v=3`, `?v=4` –∏ —Ç–∞–∫ –¥–∞–ª–µ–µ

### –ú–µ—Ç–æ–¥ 2: –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

```bash
# –ù–∞ VPS:
docker-compose down frontend
docker rmi ai-image-bot-frontend
docker system prune -af
./redeploy-frontend.sh
```

## üìä –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç

### –£—Å–ø–µ—à–Ω—ã–π –¥–µ–ø–ª–æ–π:

‚úÖ `docker ps` –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç `ai-image-bot-frontend` (Up)
‚úÖ `curl -I /` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `Cache-Control: no-cache`
‚úÖ `curl /` –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ñ–∞–π–ª—ã —Å —Ö–µ—à–∞–º–∏: `index.a1b2c3d4.js`
‚úÖ Telegram WebApp –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–æ–≤—É—é –≤–µ—Ä—Å–∏—é

### –ü—Ä–∏–∑–Ω–∞–∫–∏ –ø—Ä–æ–±–ª–µ–º—ã:

‚ùå Telegram –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ç–∞—Ä—É—é –≤–µ—Ä—Å–∏—é –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞
‚ùå `curl /` –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ñ–∞–π–ª—ã –ë–ï–ó —Ö–µ—à–µ–π: `index.js`
‚ùå `curl -I /` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `Cache-Control: max-age=31536000`

**–†–µ—à–µ–Ω–∏–µ:** –ó–∞–ø—É—Å—Ç–∏—Ç–µ `./redeploy-frontend.sh` —Å–Ω–æ–≤–∞

## üéØ Best Practice

**–ü—Ä–∏ –∫–∞–∂–¥–æ–º –¥–µ–ø–ª–æ–µ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞:**

1. ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `./redeploy-frontend.sh` (–Ω–µ `docker-compose up -d`)
2. ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ headers (`curl -I`)
3. ‚úÖ –¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ –Ω–∞ Telegram (–ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ)
4. ‚úÖ –ü—Ä–∏ –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö: –¥–æ–±–∞–≤—å—Ç–µ `?v=X` –≤ URL WebApp

**–ù–ï –¥–µ–ª–∞–π—Ç–µ:**

‚ùå `docker-compose up -d` (–º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫—ç—à)
‚ùå `npm run build && docker-compose restart frontend` (–∫—ç—à —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è)
‚ùå –î–µ–ø–ª–æ–π –±–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏ headers

## üìö –ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

–ü–æ–ª–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –≤ —Ñ–∞–π–ª–µ: [docs/CACHE_BUSTING.md](docs/CACHE_BUSTING.md)

---

## üÜò –ü–æ–º–æ—â—å

**–ù–µ —Ä–∞–±–æ—Ç–∞–µ—Ç?** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ:

1. –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –∑–∞–ø—É—â–µ–Ω: `docker ps | grep frontend`
2. –ù–µ—Ç –æ—à–∏–±–æ–∫ –≤ –ª–æ–≥–∞—Ö: `docker logs ai-image-bot-frontend`
3. Headers –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ: `curl -I https://your-domain.com/`
4. –§–∞–π–ª—ã —Å —Ö–µ—à–∞–º–∏: `curl https://your-domain.com/ | grep assets`
5. Telegram –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–∫—Ä—ã—Ç –∏ –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω

**–í—Å—ë –µ—â—ë –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç?**
‚Üí –ò–∑–º–µ–Ω–∏—Ç–µ URL WebApp –≤ BotFather (–¥–æ–±–∞–≤—å—Ç–µ `?v=2`)
